#!/bin/bash

echo "importing private GPG-Key"
gpg --import /secrets/gpg.priv

echo "importing public GPG-Key"
cat <<EOF | gpg --import
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBFbvF3ABCADltan6EuqGVgllawPtWCBUVy44QYKQxU3zLMLyuWqn5fnb17CJ
41j7wKcdKKYIfWqipK0jmLkBOaNIMrXxCZ7PE8mdyz8iKDTfiZwXZxVSOhZxbFfq
mMW3HqBwXWxATPzyHr4ql9vzm+XNd17JBvP72A7x5XpFann+0hGbgSIGF+9m9bJX
fwjZPIqP2BIlRRFmPfQgGHIqbvKiXEd/omksy/GO2feZN74lN3eaJmSHZcJ9v35w
WSZtg7gXBwPvnibAnnqMAeJiG/uR3TzjGNbb1pSlE+SO0SWOb+V5vF0YMAUdelRS
7onZ5mhBpd4IabH0kLgg4K6Cd2W0f9CItLW7ABEBAAG0KXRlbGV2b3RpYSA8dGVs
ZXZvdGlhQGlkLnBpcmF0ZW5wYXJ0ZWkuY2g+iQE+BBMBAgAoAhsDBgsJCAcDAgYV
CAIJCgsEFgIDAQIeAQIXgAUCWRMFDAUJBeZUmQAKCRDmfXKctefjpPlBCACWqdGM
wbnZpn7boDUnhOz0KxPJqQQ8RcR9gVeW/7FbzPw9H4EbBVTm0NaP6ikfMf4+Ie8P
iTH6HOt28hph0zOwx3OMd4DOzocH4oWmRUnJ/t+a2u78NqiMJpw+qo65R+g9pIMy
c5KxIMg0oh9mps70VUVw3q6lHgGToXnZ7Gq9fKolhkprw5xrcC5Jqxw+TgriqCx1
3T9eMLEfmK2Qhf/QU7QH+A60fgHjoMuCedWKTbsF34RcWRloXLww00ver/6eUQTP
3dkZpDlwR2tZbOmGnJ55IXHyTFSZcw/Rl2AjhPPjHOAVUAj459Mx4OUAiuIBhVWp
EHAsFlo0L0/GFr5JuQENBFbvF3ABCAC2raRpRsd5uW3DrhWrsChAhCWXRlmhA2Wb
QtlI+Y6tgv/9wIsPFANJl41KVyx4od2zodJrGLN8xFlwYLQrMHFZRIMeHdcJdLm8
2yRlYKZRpDpYzxEuYgghltZoyK6W/bwAYAp4T6Ev3w5kuCjuH1jNbE3ocQzCA4XP
7s/IbBjtaVKzrWWjkMHGsI6xbsZKN0cD1pR7qyBkJWRkrgjaWXt2yY5aYkyi9cEy
sd8gKPpZZMuJSvKaJ8XvNEXWis+g29I28UpVQxnk292ovp5W9LWb17nnaBt2ZC65
N3PZYVDoRV0Evf1xJ89YTiP4iUCF3gWTcWM5K9x9grFz7+mmh5yfABEBAAGJASUE
GAECAA8CGwwFAlkTBRwFCQXmVKoACgkQ5n1ynLXn46TW7QgA2YrlCVGOfoXVQTul
namW4+Sy1mwXAZ0abYJMJ5U5xH1OQR+ss4q9Eze1naUcsRL5T7yQPSdQeUP++Xs9
O9PwxxPawGl4rQWpMlVV+5ozMxHAYebMoNBj05fE7M47pDx33dFEoxU93+q14u0j
64wOH4dpkG3ksIPnLziOmyg7u0lgPjt+hwlWbZUwaC91YFK7ueQLXiOaEyWPse9c
8ABNeknutOuiz5QvVbDQ9T1dk2nUzRKUQdgtEClSRL7dttXYqgYPhXDc8DAzbOtt
MKpTZoKMbNpB7ZxbHyZDeumVlYom28Ow6Tfej8KtmBTVL/9rL/jq5mCMjl2CID/9
ZekhiA==
=SUlV
-----END PGP PUBLIC KEY BLOCK-----
EOF

echo "Backend starting..."

# Substitute configuration
for VARIABLE in $(env | cut -f1 -d=); do
	sed -i "s%{{ $VARIABLE }}%${!VARIABLE}%g" /ekklesia.ini
done
